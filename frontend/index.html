<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EA4-CleanQuote - Step 1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-xl shadow-lg p-6 sm:p-8 w-full max-w-md">
        <h1 class="text-3xl font-bold text-gray-800 mb-6 text-center">Step 1: Enter Property Info</h1>
        <form id="address-form" class="space-y-4">
            <div>
                <label for="street" class="block text-sm font-medium text-gray-700">Street Address</label>
                <input type="text" id="street" name="street" required class="mt-1 w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div>
                <label for="city" class="block text-sm font-medium text-gray-700">City</label>
                <input type="text" id="city" name="city" required class="mt-1 w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
            </div>
            <div class="grid grid-cols-2 gap-4">
                <div>
                    <label for="state" class="block text-sm font-medium text-gray-700">State</label>
                    <select id="state" name="state" required class="mt-1 w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                        <option value="OR" selected>Oregon</option>
                    </select>
                </div>
                <div>
                    <label for="zip" class="block text-sm font-medium text-gray-700">ZIP Code</label>
                    <input type="text" id="zip" name="zip" required class="mt-1 w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500">
                </div>
            </div>
            <button type="submit" id="submit-button" class="w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors">
                Check Property
            </button>
        </form>

        <!-- Message Box for Status/Error -->
        <div id="message-box" class="hidden p-4 mt-4 rounded-lg text-center"></div>
        
        <!-- ***UPDATED***: Container for cleaner info, shown after verification -->
        <div id="results-container" class="hidden mt-6 space-y-4">
            <!-- Cleaner Profile Card -->
            <div id="cleaner-profile" class="text-center">
                <h3 class="font-bold text-lg text-gray-800 mb-3">Here's Your Local CleanQuote Team</h3>
                <div class="flex flex-col items-center bg-blue-50 p-4 rounded-lg">
                    <img id="cleaner-photo" class="w-20 h-20 rounded-full object-cover border-2 border-white shadow-md mb-3" src="" alt="Cleaner photo">
                    <p id="cleaner-welcome" class="text-gray-700 font-medium"></p>
                    <p id="cleaner-bio" class="text-sm text-gray-600 mt-1"></p>
                </div>
            </div>
        </div>

        <!-- Next Step Button (initially hidden) -->
        <div id="next-step-container" class="hidden mt-6">
            <button id="next-step-button" class="w-full text-center bg-green-500 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-green-600 transition-colors">
                Continue to Next Step
            </button>
        </div>
    </div>

    <!-- ***REMOVED***: Modal pop-up is no longer needed in this step. -->

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            window.cleanQuote = window.cleanQuote || {};
            
            const form = document.getElementById('address-form');
            const messageBox = document.getElementById('message-box');
            const submitButton = document.getElementById('submit-button');
            const resultsContainer = document.getElementById('results-container');
            const nextStepContainer = document.getElementById('next-step-container');
            const nextStepButton = document.getElementById('next-step-button');

            const cleanerMap = {
                '97229': { name: 'Maria S.', photo: 'https://placehold.co/96x96/E2E8F0/A0AEC0?text=Maria', welcome: "Hi, I'm Maria! I'll be your cleaner in the Bethany area.", bio: "With over 5 years of experience, I love making homes shine." },
                '97006': { name: 'David L.', photo: 'https://placehold.co/96x96/E2E8F0/A0AEC0?text=David', welcome: "Hey there, I'm David. I service the Aloha and Cooper Mountain areas.", bio: "I'm detail-oriented and always bring a positive attitude." },
                '97007': { name: 'Jessica P.', photo: 'https://placehold.co/96x96/E2E8F0/A0AEC0?text=Jessica', welcome: "Hello, I'm Jessica, your specialist for the Tigard area.", bio: "I specialize in deep cleaning and creating organized spaces." }
            };
            const defaultCleaner = { name: 'Our Top Pro', photo: 'https://placehold.co/96x96/E2E8F0/A0AEC0?text=Pro', welcome: "One of our top-rated professionals will service your home.", bio: "Our team is fully vetted, trained, and ready to help." };

            const showMessage = (text, type = 'error') => {
                messageBox.textContent = text;
                messageBox.className = `p-4 mt-4 rounded-lg text-center ${type === 'success' ? 'bg-green-100 text-green-700' : 'bg-red-100 text-red-700'}`;
                messageBox.classList.remove('hidden');
            };

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                submitButton.textContent = 'Checking...';
                submitButton.disabled = true;
                messageBox.classList.add('hidden');
                resultsContainer.classList.add('hidden');
                nextStepContainer.classList.add('hidden');

                const formData = new FormData(form);
                const address = {
                    street: formData.get('street'),
                    city: formData.get('city'),
                    state: formData.get('state'),
                    zip: formData.get('zip')
                };

                try {
                    const response = await fetch('/property-lookup', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(address)
                    });

                    if (response.ok) {
                        const data = await response.json();
                        
                        // ***UPDATED***: Create the dynamic success message as requested.
                        const beds = data.bedrooms || 'N/A';
                        const baths = data.bathrooms || 'N/A';
                        const sqft = data.squareFootage || 'N/A';
                        const successText = `Great! We've found your ${beds} bedroom, ${baths} bathroom house with ${sqft} sq ft.`;
                        showMessage(successText, 'success');
                        
                        window.cleanQuote.propertyDetails = data;
                        window.cleanQuote.address = address;

                        // Display cleaner info
                        const cleaner = cleanerMap[address.zip] || defaultCleaner;
                        document.getElementById('cleaner-photo').src = cleaner.photo;
                        document.getElementById('cleaner-welcome').textContent = cleaner.welcome;
                        document.getElementById('cleaner-bio').textContent = cleaner.bio;

                        resultsContainer.classList.remove('hidden');
                        nextStepContainer.classList.remove('hidden');
                    } else {
                        const errorData = await response.json();
                        throw new Error(errorData.error || 'Failed to verify property.');
                    }
                } catch (error) {
                    showMessage(error.message);
                } finally {
                    submitButton.textContent = 'Check Property';
                    submitButton.disabled = false;
                }
            });

            // ***UPDATED***: Button now navigates directly to the next page.
            nextStepButton.addEventListener('click', () => {
                window.location.href = 'serviceform.html';
            });
        });
    </script>
</body>
</html>
