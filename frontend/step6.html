<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EA4-CleanQuote - Booking Confirmed</title>
    <!-- Tailwind CSS via CDN for styling -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #f7fafc;
        }
        .cleaner-photo {
            width: 96px;
            height: 96px;
            object-fit: cover;
            border-radius: 50%;
            border: 3px solid #e2e8f0; /* gray-200 */
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div class="bg-white rounded-xl shadow-lg p-6 sm:p-8 w-full max-w-lg">
        <div class="text-center space-y-4">
            <h1 class="text-4xl font-bold text-green-600">Booking Confirmed!</h1>
            <p class="text-lg text-gray-700">Thank you, <span id="customer-name" class="font-semibold"></span>!</p>
            <p class="text-gray-600">A confirmation has been sent to your email. Your cleaning is officially booked.</p>
        </div>

        <div id="booking-details" class="mt-8 space-y-4">
            <h2 class="text-2xl font-bold text-gray-800 text-center">Your Appointment</h2>
            <div class="bg-gray-50 p-4 rounded-lg space-y-2">
                <div class="flex justify-between items-center">
                    <span class="text-gray-600 font-medium">Service Date:</span>
                    <span id="booking-date-display" class="font-bold text-lg text-gray-900"></span>
                </div>
                <div class="flex justify-between items-center">
                    <span class="text-gray-600 font-medium">Arrival Time:</span>
                    <span id="booking-time-display" class="font-bold text-lg text-gray-900"></span>
                </div>
                <div class="flex justify-between items-center border-t border-gray-200 pt-2 mt-2">
                    <span class="text-gray-600 font-medium">Deposit Paid:</span>
                    <span id="deposit-paid-display" class="font-bold text-lg text-green-600"></span>
                </div>
            </div>
        </div>

        <div id="cleaner-intro" class="mt-8 text-center space-y-4">
            <h2 class="text-2xl font-bold text-gray-800">Meet Your Cleaner</h2>
            <div id="cleaner-card" class="flex flex-col items-center bg-gray-50 p-6 rounded-lg space-y-3">
                <img id="cleaner-photo" class="cleaner-photo" alt="Cleaner's Photo" src="https://placehold.co/96x96/E2E8F0/A0AEC0?text=Photo">
                <div class="space-y-1">
                    <p id="cleaner-name" class="text-xl font-bold text-gray-900"></p>
                    <p id="cleaner-bio" class="text-gray-600"></p>
                </div>
            </div>
        </div>

        <div class="mt-8 space-y-4">
            <button
                id="add-to-calendar-button"
                class="w-full bg-blue-600 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-blue-700 transition-colors"
            >
                Add to Calendar
            </button>
            <p class="text-center text-sm text-gray-500">
                Weâ€™re looking forward to making your home shine!
            </p>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Retrieve real data from the global object.
            const cleanQuote = window.cleanQuote || {};

            // Fallback to mock data only if the global object is empty (for testing purposes).
            const bookingData = cleanQuote.bookingDetails || {
                startTime: "2025-08-05T13:00:00Z",
                endTime: "2025-08-05T15:30:00Z"
            };
            const customerName = cleanQuote.customerName || 'Valued Customer';
            const depositAmount = cleanQuote.finalQuote?.depositAmount || 0;
            const customerZip = cleanQuote.address?.zip || '97229';
            const streetAddress = cleanQuote.address?.street || 'Your Home';

            // --- UI Element References ---
            const customerNameDisplay = document.getElementById('customer-name');
            const bookingDateDisplay = document.getElementById('booking-date-display');
            const bookingTimeDisplay = document.getElementById('booking-time-display');
            const depositPaidDisplay = document.getElementById('deposit-paid-display');
            const cleanerPhoto = document.getElementById('cleaner-photo');
            const cleanerName = document.getElementById('cleaner-name');
            const cleanerBio = document.getElementById('cleaner-bio');
            const addToCalendarButton = document.getElementById('add-to-calendar-button');
            
            // --- Mock Cleaner Data (as a simple example of dynamic assignment) ---
            const cleanerMap = {
                '97229': { name: 'Monica G.', bio: 'Monica has 5 years of experience and loves making homes sparkle.', photo: 'https://placehold.co/96x96/E2E8F0/A0AEC0?text=Monica' },
                '97006': { name: 'Carlos R.', bio: 'Carlos is detail-obsessed and always arrives with a smile.', photo: 'https://placehold.co/96x96/E2E8F0/A0AEC0?text=Carlos' },
                '97007': { name: 'Jessica P.', bio: 'Jessica specializes in deep cleaning and organization.', photo: 'https://placehold.co/96x96/E2E8F0/A0AEC0?text=Jessica' }
            };
            const defaultCleaner = { name: 'Our Top Pro', bio: 'An experienced member of our team will be there to make your home shine!', photo: 'https://placehold.co/96x96/E2E8F0/A0AEC0?text=Pro' };
            
            // --- Data Rendering ---
            const renderConfirmation = () => {
                customerNameDisplay.textContent = customerName;
                depositPaidDisplay.textContent = `$${depositAmount.toFixed(2)}`;
                
                const startDate = new Date(bookingData.startTime);
                const endDate = new Date(bookingData.endTime);
                
                const dateFormatter = new Intl.DateTimeFormat('en-US', { dateStyle: 'full' });
                const timeFormatter = new Intl.DateTimeFormat('en-US', { timeStyle: 'short' });

                bookingDateDisplay.textContent = dateFormatter.format(startDate);
                bookingTimeDisplay.textContent = `${timeFormatter.format(startDate)} - ${timeFormatter.format(endDate)}`;
                
                // Display cleaner info based on ZIP code
                const cleaner = cleanerMap[customerZip] || defaultCleaner;
                cleanerPhoto.src = cleaner.photo;
                cleanerName.textContent = cleaner.name;
                cleanerBio.textContent = cleaner.bio;
            };
            
            // Implemented "Add to Calendar" functionality.
            addToCalendarButton.addEventListener('click', () => {
                const startDate = new Date(bookingData.startTime);
                const endDate = new Date(bookingData.endTime);
                
                // Format dates for Google Calendar URL (YYYYMMDDTHHMMSSZ)
                const formatDateForGoogle = (date) => date.toISOString().replace(/-|:|\.\d{3}/g, '');
                
                const title = `Home Cleaning: ${streetAddress}`;
                const details = `Your cleaning appointment with CleanQuote. Your assigned cleaner is ${cleanerName.textContent}.`;
                
                const googleCalendarUrl = `https://www.google.com/calendar/render?action=TEMPLATE&text=${encodeURIComponent(title)}&dates=${formatDateForGoogle(startDate)}/${formatDateForGoogle(endDate)}&details=${encodeURIComponent(details)}&location=${encodeURIComponent(streetAddress)}`;

                window.open(googleCalendarUrl, '_blank');
            });
            
            renderConfirmation();
        });
    </script>
</body>
</html>

