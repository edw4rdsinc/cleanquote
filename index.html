<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CleanQuote - Step 1</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- ***ADDED***: Link to your logo to be used as the favicon -->
    <link rel="icon" href="images/clean-quote-logo.jpg" type="image/jpeg">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background-color: #F0F2F5;
        }
        /* Define brand colors for use with Tailwind */
        .bg-eggshell-white { background-color: #FAF9F7; }
        .bg-muted-sky { background-color: #B9C6D0; }
        .bg-warm-sand { background-color: #D6BFA7; }
        .text-deep-graphite { color: #2E2E2E; }
        .border-warm-sand { border-color: #D6BFA7; }
        .hover\:bg-warm-sand-dark:hover { background-color: #c9a88b; }
        
        /* Animation Keyframes */
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        @keyframes slideUpFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Animation Classes */
        .fade-in {
            animation: fadeIn 0.6s ease-out forwards;
        }
        .slide-up-fade-in {
            animation: slideUpFadeIn 0.5s ease-out forwards;
        }
        
        /* Staggered animation for form elements */
        .form-element {
            opacity: 0;
            animation: fadeIn 0.5s ease-out forwards;
        }
    </style>
</head>
<body class="flex items-center justify-center min-h-screen p-4">
    <div id="main-card" class="bg-eggshell-white rounded-xl shadow-lg p-6 sm:p-8 w-full max-w-md opacity-0 fade-in">
        <!-- Logo -->
        <div class="text-center mb-6">
            <img src="images/clean-quote-logo.jpg" alt="CleanQuote Logo" class="w-24 h-24 mx-auto">
        </div>

        <h1 class="text-3xl font-bold text-deep-graphite mb-2 text-center form-element" style="animation-delay: 0.1s;">Get Your Clean Quote</h1>
        <p class="text-center text-deep-graphite opacity-80 mb-6 form-element" style="animation-delay: 0.2s;">Fast, accurate, and transparent pricing for your cleaner home.</p>
        
        <form id="address-form" class="space-y-4">
            <div class="form-element" style="animation-delay: 0.3s;">
                <label for="street" class="block text-sm font-medium text-deep-graphite">Street Address</label>
                <input type="text" id="street" name="street" required class="mt-1 w-full p-3 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-warm-sand">
            </div>
            <div class="form-element" style="animation-delay: 0.4s;">
                <label for="city" class="block text-sm font-medium text-deep-graphite">City</label>
                <input type="text" id="city" name="city" required class="mt-1 w-full p-3 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-warm-sand">
            </div>
            <div class="grid grid-cols-2 gap-4 form-element" style="animation-delay: 0.5s;">
                <div>
                    <label for="state" class="block text-sm font-medium text-deep-graphite">State</label>
                    <select id="state" name="state" required class="mt-1 w-full p-3 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-warm-sand">
                        <option value="OR" selected>Oregon</option>
                    </select>
                </div>
                <div>
                    <label for="zip" class="block text-sm font-medium text-deep-graphite">ZIP Code</label>
                    <input type="text" id="zip" name="zip" required class="mt-1 w-full p-3 bg-white border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-warm-sand">
                </div>
            </div>
            <p class="text-xs text-center text-deep-graphite opacity-60 pt-2 form-element" style="animation-delay: 0.6s;">All cleaners are background-checked and insured.</p>
            <button type="submit" id="submit-button" class="w-full bg-warm-sand text-deep-graphite font-semibold py-3 rounded-lg shadow-md hover:bg-warm-sand-dark transition-colors form-element" style="animation-delay: 0.7s;">
                Check Property
            </button>
        </form>
        
        <p class="text-xs text-center text-deep-graphite opacity-60 mt-4">ðŸ”’ We respect your privacy and will never share your address.</p>

        <div id="message-box" class="hidden p-4 mt-4 rounded-lg text-center"></div>
        
        <div id="results-container" class="hidden mt-6 space-y-4">
            <div id="cleaner-profile" class="text-center bg-muted-sky bg-opacity-40 p-4 rounded-lg">
                <h3 class="font-bold text-lg text-deep-graphite mb-3">Here's Your Local CleanQuote Team</h3>
                <div class="flex flex-col items-center">
                    <img id="cleaner-photo" class="w-20 h-20 rounded-full object-cover border-2 border-white shadow-md mb-3" src="" alt="Cleaner photo">
                    <p id="cleaner-welcome" class="text-deep-graphite font-medium"></p>
                    <p id="cleaner-bio" class="text-sm text-deep-graphite opacity-80 mt-1"></p>
                </div>
            </div>
        </div>

        <div id="next-step-container" class="hidden mt-6">
            <button id="next-step-button" class="w-full text-center bg-green-500 text-white font-semibold py-3 rounded-lg shadow-md hover:bg-green-600 transition-colors">
                Continue to Next Step
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            window.cleanQuote = window.cleanQuote || {};
            
            const form = document.getElementById('address-form');
            const messageBox = document.getElementById('message-box');
            const submitButton = document.getElementById('submit-button');
            const resultsContainer = document.getElementById('results-container');
            const nextStepContainer = document.getElementById('next-step-container');
            const nextStepButton = document.getElementById('next-step-button');

            const cleanerMap = {
                '97229': { name: 'Jamie M.', photo: 'https://placehold.co/96x96/E2E8F0/A0AEC0?text=Maria', welcome: "Hi, I'm Jamie! I'll be your cleaner in the Bethany area.", bio: "I love camping, cats, and making your Bethany home sparkle.  I have 10 years of experience and I'm efficient and thorough." },
                '97291': { name: 'Jamie M.', photo: 'https://placehold.co/96x96/E2E8F0/A0AEC0?text=Maria', welcome: "Hi, I'm Jamie! I'll be your cleaner in the Bethany area.", bio: "I love camping, cats, and making your Bethany home sparkle.  I have 10 years of experience and I'm efficient and thorough." } //
                const defaultCleaner = { name: 'Our Top Pro', photo: 'https://placehold.co/96x96/E2E8F0/A0AEC0?text=Pro', welcome: "One of our top-rated professionals will service your home.", bio: "Our team is fully vetted, trained, and ready to help." };

            const showMessage = (text, type = 'error') => {
                messageBox.textContent = text;
                messageBox.className = `p-4 mt-4 rounded-lg text-center ${type === 'success' ? 'bg-green-100 text-green-800' : 'bg-red-100 text-red-700'}`;
                messageBox.classList.remove('hidden');
                messageBox.classList.add('slide-up-fade-in');
            };

            form.addEventListener('submit', async (e) => {
                e.preventDefault();
                submitButton.textContent = 'Checking...';
                submitButton.disabled = true;
                messageBox.classList.add('hidden');
                resultsContainer.classList.add('hidden');
                nextStepContainer.classList.add('hidden');

                const formData = new FormData(form);
                const address = { street: formData.get('street'), city: formData.get('city'), state: formData.get('state'), zip: formData.get('zip') };

                try {
                    const response = await fetch('/property-lookup', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify(address) });
                    
                    if (!response.ok) {
                        const contentType = response.headers.get("content-type");
                        let errorText;
                        if (contentType && contentType.indexOf("application/json") !== -1) {
                            const errorData = await response.json();
                            errorText = errorData.error || 'Failed to verify property.';
                        } else {
                            errorText = await response.text();
                        }
                        throw new Error(errorText);
                    }
                    
                    const data = await response.json();
                    
                    const beds = data.bedrooms || 'N/A';
                    const baths = data.bathrooms || 'N/A';
                    const sqft = data.squareFootage || 'N/A';
                    const successText = `Great! We've found your ${beds} bed, ${baths} bath home with ${sqft} sq ft.`;
                    showMessage(successText, 'success');
                    
                    sessionStorage.setItem('cleanQuoteData', JSON.stringify({ propertyDetails: data, address: address }));

                    const cleaner = cleanerMap[address.zip] || defaultCleaner;
                    document.getElementById('cleaner-photo').src = cleaner.photo;
                    document.getElementById('cleaner-welcome').textContent = cleaner.welcome;
                    document.getElementById('cleaner-bio').textContent = cleaner.bio;

                    resultsContainer.classList.remove('hidden');
                    resultsContainer.classList.add('slide-up-fade-in');
                    nextStepContainer.classList.remove('hidden');
                    nextStepContainer.classList.add('slide-up-fade-in');

                } catch (error) {
                    showMessage(error.message);
                } finally {
                    submitButton.textContent = 'Check Property';
                    submitButton.disabled = false;
                }
            });

            nextStepButton.addEventListener('click', () => {
                window.location.href = 'serviceform.html';
            });
        });
    </script>
</body>
</html>
